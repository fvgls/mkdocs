<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>build.py</title>
  <link rel="stylesheet" href="../../pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>build.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">calendar</span> <span class="kn">import</span> <span class="n">timegm</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>

<span class="kn">from</span> <span class="nn">jinja2.exceptions</span> <span class="kn">import</span> <span class="n">TemplateNotFound</span>
<span class="kn">import</span> <span class="nn">jinja2</span>

<span class="kn">from</span> <span class="nn">mkdocs</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">mkdocs.structure.files</span> <span class="kn">import</span> <span class="n">get_files</span>
<span class="kn">from</span> <span class="nn">mkdocs.structure.nav</span> <span class="kn">import</span> <span class="n">get_navigation</span>
<span class="kn">import</span> <span class="nn">mkdocs</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">DuplicateFilter</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Avoid logging duplicate messages. &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msgs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">msg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">msgs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msgs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rv</span>


<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">addFilter</span><span class="p">(</span><span class="n">DuplicateFilter</span><span class="p">())</span>
<span class="n">log</span><span class="o">.</span><span class="n">addFilter</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">warning_filter</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Return the template context for a given page or template.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="n">nav</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">page</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_relative_url</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="n">extra_javascript</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">create_media_urls</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;extra_javascript&#39;</span><span class="p">],</span> <span class="n">page</span><span class="p">,</span> <span class="n">base_url</span><span class="p">)</span>

    <span class="n">extra_css</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">create_media_urls</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;extra_css&#39;</span><span class="p">],</span> <span class="n">page</span><span class="p">,</span> <span class="n">base_url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Support SOURCE_DATE_EPOCH environment variable for &ldquo;reproducible&rdquo; builds.
See https://reproducible-builds.org/specs/source-date-epoch/</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SOURCE_DATE_EPOCH&#39;</span><span class="p">,</span> <span class="n">timegm</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">utctimetuple</span><span class="p">())))</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;nav&#39;</span><span class="p">:</span> <span class="n">nav</span><span class="p">,</span>
        <span class="s1">&#39;pages&#39;</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">documentation_pages</span><span class="p">(),</span>

        <span class="s1">&#39;base_url&#39;</span><span class="p">:</span> <span class="n">base_url</span><span class="p">,</span>

        <span class="s1">&#39;extra_css&#39;</span><span class="p">:</span> <span class="n">extra_css</span><span class="p">,</span>
        <span class="s1">&#39;extra_javascript&#39;</span><span class="p">:</span> <span class="n">extra_javascript</span><span class="p">,</span>

        <span class="s1">&#39;mkdocs_version&#39;</span><span class="p">:</span> <span class="n">mkdocs</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
        <span class="s1">&#39;build_date_utc&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">),</span>

        <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">,</span>
        <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>Return rendered output for given template as a string.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_build_template</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">nav</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>Run <code>pre_template</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">template</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span>
        <span class="s1">&#39;pre_template&#39;</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_error_template</span><span class="p">(</span><span class="n">name</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Force absolute URLs in the nav of error pages and account for the
possability that the docs root might be different than the server root.
See https://github.com/mkdocs/mkdocs/issues/77.
However, if site_url is not set, assume the docs root and server root
are the same. See https://github.com/mkdocs/mkdocs/issues/1598.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">base_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;site_url&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_relative_url</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="n">context</span> <span class="o">=</span> <span class="n">get_context</span><span class="p">(</span><span class="n">nav</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Run <code>template_context</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">context</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span>
        <span class="s1">&#39;template_context&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span>
    <span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Run <code>post_template</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">output</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span>
        <span class="s1">&#39;post_template&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Build a template using the theme environment.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_build_theme_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">nav</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Building theme template: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">template_name</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">TemplateNotFound</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Template skipped: &#39;</span><span class="si">{}</span><span class="s2">&#39; not found in theme directories.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">template_name</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">_build_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">nav</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;site_dir&#39;</span><span class="p">],</span> <span class="n">template_name</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">output_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">template_name</span> <span class="o">==</span> <span class="s1">&#39;sitemap.xml&#39;</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Gzipping template: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">template_name</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.gz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Template skipped: &#39;</span><span class="si">{}</span><span class="s2">&#39; generated empty output.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">template_name</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Build user templates which are not part of the theme.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_build_extra_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">nav</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Building extra template: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">template_name</span><span class="p">))</span>

    <span class="n">file</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">get_file_from_path</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Template skipped: &#39;</span><span class="si">{}</span><span class="s2">&#39; not found in docs_dir.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">template_name</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">abs_src_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error reading template &#39;</span><span class="si">{}</span><span class="s2">&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">_build_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">nav</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">file</span><span class="o">.</span><span class="n">abs_dest_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Template skipped: &#39;</span><span class="si">{}</span><span class="s2">&#39; generated empty output.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">template_name</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>Read page content from docs_dir and render Markdown.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_populate_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">dirty</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">try</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>When &ndash;dirty is used, only read the page if the file has been modified since the
previous build of the output.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">dirty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">is_modified</span><span class="p">():</span>
            <span class="k">return</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>Run the <code>pre_page</code> plugin event</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">page</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span>
            <span class="s1">&#39;pre_page&#39;</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span>
        <span class="p">)</span>

        <span class="n">page</span><span class="o">.</span><span class="n">read_source</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Run <code>page_markdown</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">page</span><span class="o">.</span><span class="n">markdown</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span>
            <span class="s1">&#39;page_markdown&#39;</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">markdown</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span>
        <span class="p">)</span>

        <span class="n">page</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Run <code>page_content</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">page</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span>
            <span class="s1">&#39;page_content&#39;</span><span class="p">,</span> <span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error reading page &#39;</span><span class="si">{}</span><span class="s2">&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">src_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>Pass a Page to theme template and write output to site_dir.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_build_page</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">nav</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">dirty</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">try</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>When &ndash;dirty is used, only build the page if the file has been modified since the
previous build of the output.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">dirty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">is_modified</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Building page </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">src_path</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>Activate page. Signals to theme that this is the current page.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">page</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">context</span> <span class="o">=</span> <span class="n">get_context</span><span class="p">(</span><span class="n">nav</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>Allow &lsquo;template:&rsquo; override in md source files.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="s1">&#39;template&#39;</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s1">&#39;main.html&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Run <code>page_context</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">context</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span>
            <span class="s1">&#39;page_context&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">nav</span><span class="o">=</span><span class="n">nav</span>
        <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>Render the template.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">output</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>Run <code>post_page</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">output</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span>
            <span class="s1">&#39;post_page&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span>
        <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>Write the output file.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;xmlcharrefreplace&#39;</span><span class="p">),</span> <span class="n">page</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">abs_dest_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Page skipped: &#39;</span><span class="si">{}</span><span class="s2">&#39;. Generated empty output.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">src_path</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>Deactivate page</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">page</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error building page &#39;</span><span class="si">{}</span><span class="s2">&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">src_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>Perform a full site build.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">live_server</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dirty</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>Run <code>config</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>Run <code>pre_build</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span><span class="s1">&#39;pre_build&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dirty</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning site directory&quot;</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">clean_directory</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;site_dir&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>Warn user about problems that may occur with &ndash;dirty option</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;A &#39;dirty&#39; build is being performed, this will likely lead to inaccurate navigation and other&quot;</span>
                    <span class="s2">&quot; links within your site. This option is designed for site development purposes only.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">live_server</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Building documentation to directory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;site_dir&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">dirty</span> <span class="ow">and</span> <span class="n">site_directory_contains_stale_files</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;site_dir&#39;</span><span class="p">]):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The directory contains stale files. Use --clean to remove them.&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>First gather all data from all files/pages to ensure all data is consistent across all pages.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">files</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;theme&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_env</span><span class="p">()</span>
    <span class="n">files</span><span class="o">.</span><span class="n">add_files_from_theme</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>Run <code>files</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">files</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

    <span class="n">nav</span> <span class="o">=</span> <span class="n">get_navigation</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>Run <code>nav</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">nav</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span><span class="s1">&#39;nav&#39;</span><span class="p">,</span> <span class="n">nav</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Reading markdown pages.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">documentation_pages</span><span class="p">():</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Reading: &quot;</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="n">src_path</span><span class="p">)</span>
        <span class="n">_populate_page</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">dirty</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>Run <code>env</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">env</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span>
        <span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span>
    <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>Start writing files to site_dir now that all data is gathered. Note that order matters. Files
with lower precedence get written first so that files with higher precedence can overwrite them.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Copying static assets.&quot;</span><span class="p">)</span>
    <span class="n">files</span><span class="o">.</span><span class="n">copy_static_files</span><span class="p">(</span><span class="n">dirty</span><span class="o">=</span><span class="n">dirty</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;theme&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">static_templates</span><span class="p">:</span>
        <span class="n">_build_theme_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">nav</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;extra_templates&#39;</span><span class="p">]:</span>
        <span class="n">_build_extra_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">nav</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Building markdown pages.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">documentation_pages</span><span class="p">():</span>
        <span class="n">_build_page</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">nav</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">dirty</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>Run <code>post_build</code> plugin events.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run_event</span><span class="p">(</span><span class="s1">&#39;post_build&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;strict&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">utils</span><span class="o">.</span><span class="n">warning_filter</span><span class="o">.</span><span class="n">count</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Exited with </span><span class="si">{}</span><span class="s1"> warnings in strict mode.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">warning_filter</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Documentation built in </span><span class="si">%.2f</span><span class="s1"> seconds&#39;</span><span class="p">,</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>Check if the site directory contains stale files from a previous build.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">site_directory_contains_stale_files</span><span class="p">(</span><span class="n">site_directory</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">site_directory</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">site_directory</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
